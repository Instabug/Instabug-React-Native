version: 2
jobs:
  publish:
    macos:
      xcode: "10.1.0"
    steps:
      - checkout
      # - run: git clone -b react-native --single-branch https://InstabugCI:$RELEASE_GITHUB_TOKEN@github.com/Instabug/Escape.git
      # - run: cd Escape; swift build -c release -Xswiftc -static-stdlib
      # - run: cd Escape/.build/release; cp -f Escape /usr/local/bin/escape
      # - run: Escape react-native publish
  run_sample_app:
    macos:
      xcode: "10.2.0"
    environment:
      ANDROID_HOME: "/usr/local/share/android-sdk"
      PATH: "$PATH:$ANDROID_HOME/tools/bin"
    dependencies:
      pre:
        - bash ./scripts/circle-install-android-sdk.sh
    working_directory: ~/project/InstabugSample
    steps:
      - checkout:
          path: ~/project
      - run: which npm
      - run: yarn install
      - run: yarn global add react-native
      - run: yarn global add react-native-cli
      - run: sudo chmod 755 'install_android_sdk.sh'
      - run: react-native link instabug-reactnative
      - run: react-native run-android
      - run: react-native run-ios


workflows:
  version: 2
  publish:
    jobs:
      - run_sample_app
      - publish:
          requires:
            - run_sample_app